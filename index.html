<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家計簿アプリ</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
</head>
<body>
    <script>
        // 認証チェック - 未ログインならログイン画面へリダイレクト
        if (!localStorage.getItem('auth_token')) {
            window.location.href = '/login';
        }
    </script>
    <div class="app-container">
        <header>
            <h1>家計簿アプリ</h1>
            <nav>
                <button class="nav-btn active" data-tab="input">入力</button>
                <button class="nav-btn" data-tab="list">一覧</button>
                <button class="nav-btn" data-tab="budget">予算管理</button>
                <button class="nav-btn" data-tab="income">収支</button>
                <button class="nav-btn" data-tab="subscription">定期払い</button>
                <button class="nav-btn" data-tab="goals">目標</button>
                <button class="nav-btn" data-tab="chart">チャート</button>
                <button class="nav-btn" data-tab="calendar">カレンダー</button>
                <button class="nav-btn" data-tab="report">レポート</button>
                <button class="nav-btn" data-tab="data">データ</button>
                <button class="nav-btn" data-tab="family">家族</button>
                <button class="nav-btn" data-tab="gamification">実績</button>
                <button class="nav-btn" data-tab="link">外部連携</button>
            </nav>
        </header>

        <main>
            <!-- 入力タブ -->
            <section id="input" class="tab-content active">
                <h2>支出入力</h2>

                <!-- レシート撮影 -->
                <div class="receipt-section">
                    <h3>レシート撮影で入力</h3>
                    <div class="receipt-upload">
                        <input type="file" id="receiptInput" accept="image/*" capture="environment">
                        <label for="receiptInput" class="upload-btn">
                            <span class="camera-icon">📷</span>
                            レシートを撮影/選択
                        </label>
                        <div id="ocrStatus" class="ocr-status"></div>
                    </div>
                    <div id="receiptPreview" class="receipt-preview"></div>
                </div>

                <div class="divider">または手動入力</div>

                <!-- 手動入力フォーム -->
                <form id="expenseForm" class="expense-form">
                    <div class="form-group">
                        <label for="expenseDate">日付</label>
                        <input type="date" id="expenseDate" required>
                    </div>
                    <div class="form-group">
                        <label for="expenseDescription">説明</label>
                        <input type="text" id="expenseDescription" placeholder="例: スーパーで買い物" required>
                    </div>
                    <div class="form-group">
                        <label for="expenseAmount">金額</label>
                        <input type="number" id="expenseAmount" placeholder="0" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="expenseCategory">カテゴリ</label>
                        <select id="expenseCategory" required>
                            <option value="">選択してください</option>
                            <option value="食費">食費</option>
                            <option value="日用品">日用品</option>
                            <option value="交通費">交通費</option>
                            <option value="光熱費">光熱費</option>
                            <option value="通信費">通信費</option>
                            <option value="住居費">住居費</option>
                            <option value="医療費">医療費</option>
                            <option value="娯楽費">娯楽費</option>
                            <option value="衣服費">衣服費</option>
                            <option value="教育費">教育費</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>
                    <button type="submit" class="submit-btn">登録</button>
                </form>
            </section>

            <!-- 一覧タブ -->
            <section id="list" class="tab-content">
                <h2>支出一覧</h2>

                <!-- フィルター -->
                <div class="filter-section">
                    <div class="filter-group">
                        <label>期間:</label>
                        <input type="date" id="filterStartDate">
                        <span>〜</span>
                        <input type="date" id="filterEndDate">
                    </div>
                    <div class="filter-group">
                        <label>カテゴリ:</label>
                        <select id="filterCategory">
                            <option value="">すべて</option>
                            <option value="食費">食費</option>
                            <option value="日用品">日用品</option>
                            <option value="交通費">交通費</option>
                            <option value="光熱費">光熱費</option>
                            <option value="通信費">通信費</option>
                            <option value="住居費">住居費</option>
                            <option value="医療費">医療費</option>
                            <option value="娯楽費">娯楽費</option>
                            <option value="衣服費">衣服費</option>
                            <option value="教育費">教育費</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>説明:</label>
                        <input type="text" id="filterDescription" placeholder="キーワード検索">
                    </div>
                    <button id="applyFilter" class="filter-btn">絞り込み</button>
                    <button id="clearFilter" class="filter-btn secondary">クリア</button>
                </div>

                <!-- 集計サマリー -->
                <div class="summary-section">
                    <div class="summary-card">
                        <h4>表示中の合計</h4>
                        <p id="filteredTotal" class="summary-value">¥0</p>
                    </div>
                </div>

                <!-- カテゴリ別集計 -->
                <div class="category-summary">
                    <h3>カテゴリ別集計</h3>
                    <div id="categorySummary" class="category-summary-grid"></div>
                </div>

                <!-- 支出テーブル -->
                <div class="table-container">
                    <table id="expenseTable">
                        <thead>
                            <tr>
                                <th>日付</th>
                                <th>説明</th>
                                <th>金額</th>
                                <th>カテゴリ</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="expenseTableBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 予算管理タブ -->
            <section id="budget" class="tab-content">
                <h2>予算管理</h2>

                <div class="budget-month">
                    <label>対象月:</label>
                    <input type="month" id="budgetMonth">
                </div>

                <div class="budget-grid">
                    <div class="budget-item">
                        <label>食費</label>
                        <input type="number" class="budget-input" data-category="食費" placeholder="0">
                    </div>
                    <div class="budget-item">
                        <label>日用品</label>
                        <input type="number" class="budget-input" data-category="日用品" placeholder="0">
                    </div>
                    <div class="budget-item">
                        <label>交通費</label>
                        <input type="number" class="budget-input" data-category="交通費" placeholder="0">
                    </div>
                    <div class="budget-item">
                        <label>光熱費</label>
                        <input type="number" class="budget-input" data-category="光熱費" placeholder="0">
                    </div>
                    <div class="budget-item">
                        <label>通信費</label>
                        <input type="number" class="budget-input" data-category="通信費" placeholder="0">
                    </div>
                    <div class="budget-item">
                        <label>住居費</label>
                        <input type="number" class="budget-input" data-category="住居費" placeholder="0">
                    </div>
                    <div class="budget-item">
                        <label>医療費</label>
                        <input type="number" class="budget-input" data-category="医療費" placeholder="0">
                    </div>
                    <div class="budget-item">
                        <label>娯楽費</label>
                        <input type="number" class="budget-input" data-category="娯楽費" placeholder="0">
                    </div>
                    <div class="budget-item">
                        <label>衣服費</label>
                        <input type="number" class="budget-input" data-category="衣服費" placeholder="0">
                    </div>
                    <div class="budget-item">
                        <label>教育費</label>
                        <input type="number" class="budget-input" data-category="教育費" placeholder="0">
                    </div>
                    <div class="budget-item">
                        <label>その他</label>
                        <input type="number" class="budget-input" data-category="その他" placeholder="0">
                    </div>
                </div>

                <button id="saveBudget" class="submit-btn">予算を保存</button>

                <!-- 予実対比表 -->
                <div class="budget-comparison">
                    <h3>予実対比</h3>
                    <table id="budgetComparisonTable">
                        <thead>
                            <tr>
                                <th>カテゴリ</th>
                                <th>予算</th>
                                <th>実績</th>
                                <th>差額</th>
                                <th>達成率</th>
                            </tr>
                        </thead>
                        <tbody id="budgetComparisonBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- チャートタブ -->
            <section id="chart" class="tab-content">
                <h2>グラフ分析</h2>

                <div class="chart-controls">
                    <label>表示月:</label>
                    <input type="month" id="chartMonth">
                </div>

                <div class="charts-container">
                    <div class="chart-wrapper">
                        <h3>予算 vs 実績</h3>
                        <canvas id="budgetVsActualChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <h3>カテゴリ別支出割合</h3>
                        <canvas id="categoryPieChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <h3>差額（予算 - 実績）</h3>
                        <canvas id="differenceChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- カレンダータブ -->
            <section id="calendar" class="tab-content">
                <h2>カレンダー</h2>

                <div class="calendar-controls">
                    <button id="prevMonth" class="calendar-nav">◀</button>
                    <span id="calendarMonth" class="calendar-title"></span>
                    <button id="nextMonth" class="calendar-nav">▶</button>
                </div>

                <div class="calendar-grid">
                    <div class="calendar-header">日</div>
                    <div class="calendar-header">月</div>
                    <div class="calendar-header">火</div>
                    <div class="calendar-header">水</div>
                    <div class="calendar-header">木</div>
                    <div class="calendar-header">金</div>
                    <div class="calendar-header">土</div>
                </div>
                <div id="calendarDays" class="calendar-days"></div>

                <!-- 日別詳細 -->
                <div id="dayDetail" class="day-detail">
                    <h3 id="dayDetailTitle"></h3>
                    <div id="dayDetailContent"></div>
                </div>
            </section>

            <!-- 収支管理タブ -->
            <section id="income" class="tab-content">
                <h2>収支管理</h2>

                <!-- 収入入力 -->
                <div class="income-section">
                    <h3>収入を登録</h3>
                    <form id="incomeForm" class="expense-form">
                        <div class="form-group">
                            <label for="incomeDate">日付</label>
                            <input type="date" id="incomeDate" required>
                        </div>
                        <div class="form-group">
                            <label for="incomeDescription">説明</label>
                            <input type="text" id="incomeDescription" placeholder="例: 給与、副業収入" required>
                        </div>
                        <div class="form-group">
                            <label for="incomeAmount">金額</label>
                            <input type="number" id="incomeAmount" placeholder="0" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="incomeCategory">カテゴリ</label>
                            <select id="incomeCategory" required>
                                <option value="給与">給与</option>
                                <option value="副業">副業</option>
                                <option value="投資収益">投資収益</option>
                                <option value="ボーナス">ボーナス</option>
                                <option value="臨時収入">臨時収入</option>
                                <option value="その他収入">その他収入</option>
                            </select>
                        </div>
                        <button type="submit" class="submit-btn income-btn">収入を登録</button>
                    </form>
                </div>

                <!-- 収支サマリー -->
                <div class="balance-summary">
                    <h3>今月の収支</h3>
                    <div class="balance-cards">
                        <div class="balance-card income-card">
                            <span class="balance-label">収入</span>
                            <span id="totalIncome" class="balance-amount">¥0</span>
                        </div>
                        <div class="balance-card expense-card">
                            <span class="balance-label">支出</span>
                            <span id="totalExpenseBalance" class="balance-amount">¥0</span>
                        </div>
                        <div class="balance-card net-card">
                            <span class="balance-label">収支</span>
                            <span id="netBalance" class="balance-amount">¥0</span>
                        </div>
                        <div class="balance-card savings-card">
                            <span class="balance-label">貯蓄率</span>
                            <span id="savingsRate" class="balance-amount">0%</span>
                        </div>
                    </div>
                </div>

                <!-- 収入一覧 -->
                <div class="income-list">
                    <h3>収入履歴</h3>
                    <table id="incomeTable">
                        <thead>
                            <tr>
                                <th>日付</th>
                                <th>説明</th>
                                <th>金額</th>
                                <th>カテゴリ</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="incomeTableBody"></tbody>
                    </table>
                </div>

                <!-- 収支チャート -->
                <div class="balance-chart">
                    <h3>月次収支推移</h3>
                    <canvas id="balanceChart"></canvas>
                </div>
            </section>

            <!-- 定期支出・サブスク管理タブ -->
            <section id="subscription" class="tab-content">
                <h2>定期支出・サブスクリプション管理</h2>

                <!-- 定期支出登録 -->
                <div class="subscription-form-section">
                    <h3>定期支出を登録</h3>
                    <form id="subscriptionForm" class="expense-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="subName">サービス名</label>
                                <input type="text" id="subName" placeholder="例: Netflix" required>
                            </div>
                            <div class="form-group">
                                <label for="subAmount">金額</label>
                                <input type="number" id="subAmount" placeholder="0" min="0" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="subCategory">カテゴリ</label>
                                <select id="subCategory" required>
                                    <option value="動画配信">動画配信</option>
                                    <option value="音楽配信">音楽配信</option>
                                    <option value="クラウド">クラウドストレージ</option>
                                    <option value="ソフトウェア">ソフトウェア</option>
                                    <option value="ジム">ジム・フィットネス</option>
                                    <option value="保険">保険</option>
                                    <option value="通信">通信費</option>
                                    <option value="光熱費">光熱費</option>
                                    <option value="家賃">家賃</option>
                                    <option value="その他">その他</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="subCycle">支払いサイクル</label>
                                <select id="subCycle" required>
                                    <option value="monthly">毎月</option>
                                    <option value="yearly">年1回</option>
                                    <option value="weekly">毎週</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="subPayDay">支払日</label>
                                <input type="number" id="subPayDay" min="1" max="31" placeholder="1-31" required>
                            </div>
                            <div class="form-group">
                                <label for="subStartDate">開始日</label>
                                <input type="date" id="subStartDate" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="subNotify" checked>
                                支払日の3日前に通知
                            </label>
                        </div>
                        <button type="submit" class="submit-btn">登録</button>
                    </form>
                </div>

                <!-- サブスクサマリー -->
                <div class="subscription-summary">
                    <div class="sub-summary-card">
                        <span class="sub-summary-label">月額合計</span>
                        <span id="monthlySubTotal" class="sub-summary-value">¥0</span>
                    </div>
                    <div class="sub-summary-card">
                        <span class="sub-summary-label">年間合計</span>
                        <span id="yearlySubTotal" class="sub-summary-value">¥0</span>
                    </div>
                    <div class="sub-summary-card">
                        <span class="sub-summary-label">契約数</span>
                        <span id="subCount" class="sub-summary-value">0件</span>
                    </div>
                </div>

                <!-- 支払い予定 -->
                <div class="upcoming-payments">
                    <h3>今後の支払い予定</h3>
                    <div id="upcomingPaymentsList" class="upcoming-list"></div>
                </div>

                <!-- サブスク一覧 -->
                <div class="subscription-list">
                    <h3>登録中のサブスクリプション</h3>
                    <div id="subscriptionCards" class="subscription-cards"></div>
                </div>
            </section>

            <!-- 目標設定・貯金管理タブ -->
            <section id="goals" class="tab-content">
                <h2>目標設定・貯金管理</h2>

                <!-- 目標登録 -->
                <div class="goal-form-section">
                    <h3>新しい目標を設定</h3>
                    <form id="goalForm" class="expense-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="goalName">目標名</label>
                                <input type="text" id="goalName" placeholder="例: 旅行資金" required>
                            </div>
                            <div class="form-group">
                                <label for="goalIcon">アイコン</label>
                                <select id="goalIcon">
                                    <option value="✈️">✈️ 旅行</option>
                                    <option value="🚗">🚗 車</option>
                                    <option value="🏠">🏠 住宅</option>
                                    <option value="💻">💻 家電</option>
                                    <option value="📚">📚 教育</option>
                                    <option value="💍">💍 結婚</option>
                                    <option value="👶">👶 出産</option>
                                    <option value="🎓">🎓 留学</option>
                                    <option value="💰">💰 貯金</option>
                                    <option value="🎯">🎯 その他</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="goalTarget">目標金額</label>
                                <input type="number" id="goalTarget" placeholder="0" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="goalDeadline">目標期日</label>
                                <input type="date" id="goalDeadline" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="goalInitial">現在の貯金額</label>
                            <input type="number" id="goalInitial" placeholder="0" min="0" value="0">
                        </div>
                        <button type="submit" class="submit-btn">目標を設定</button>
                    </form>
                </div>

                <!-- 目標一覧 -->
                <div class="goals-list">
                    <h3>設定中の目標</h3>
                    <div id="goalCards" class="goal-cards"></div>
                </div>

                <!-- 貯金入金モーダル用の非表示入力 -->
                <div id="depositModal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h3>貯金を追加</h3>
                        <form id="depositForm">
                            <input type="hidden" id="depositGoalId">
                            <div class="form-group">
                                <label for="depositAmount">入金額</label>
                                <input type="number" id="depositAmount" min="0" required>
                            </div>
                            <button type="submit" class="submit-btn">入金</button>
                        </form>
                    </div>
                </div>
            </section>

            <!-- レポート・分析タブ -->
            <section id="report" class="tab-content">
                <h2>レポート・分析</h2>

                <!-- レポート期間選択 -->
                <div class="report-controls">
                    <div class="report-period">
                        <label>期間:</label>
                        <select id="reportPeriod">
                            <option value="thisMonth">今月</option>
                            <option value="lastMonth">先月</option>
                            <option value="last3Months">過去3ヶ月</option>
                            <option value="last6Months">過去6ヶ月</option>
                            <option value="thisYear">今年</option>
                            <option value="custom">カスタム</option>
                        </select>
                    </div>
                    <div class="report-custom-period" id="customPeriod" style="display:none;">
                        <input type="date" id="reportStartDate">
                        <span>〜</span>
                        <input type="date" id="reportEndDate">
                    </div>
                    <button id="generateReport" class="submit-btn">レポート生成</button>
                    <button id="exportReportPdf" class="export-btn">PDF出力</button>
                </div>

                <!-- レポートサマリー -->
                <div class="report-summary">
                    <div class="report-card">
                        <h4>総収入</h4>
                        <p id="reportTotalIncome" class="report-value positive">¥0</p>
                    </div>
                    <div class="report-card">
                        <h4>総支出</h4>
                        <p id="reportTotalExpense" class="report-value negative">¥0</p>
                    </div>
                    <div class="report-card">
                        <h4>収支差額</h4>
                        <p id="reportNetBalance" class="report-value">¥0</p>
                    </div>
                    <div class="report-card">
                        <h4>1日平均支出</h4>
                        <p id="reportDailyAvg" class="report-value">¥0</p>
                    </div>
                </div>

                <!-- 前期比較 -->
                <div class="period-comparison">
                    <h3>前期比較</h3>
                    <div id="comparisonContent" class="comparison-grid"></div>
                </div>

                <!-- 異常検知 -->
                <div class="anomaly-detection">
                    <h3>異常支出アラート</h3>
                    <div id="anomalyAlerts" class="anomaly-list">
                        <p class="no-anomaly">異常な支出は検出されていません</p>
                    </div>
                </div>

                <!-- カテゴリ別分析 -->
                <div class="category-analysis">
                    <h3>カテゴリ別分析</h3>
                    <div class="analysis-charts">
                        <div class="analysis-chart">
                            <canvas id="reportCategoryChart"></canvas>
                        </div>
                        <div class="analysis-chart">
                            <canvas id="reportTrendChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- データ管理タブ -->
            <section id="data" class="tab-content">
                <h2>データ管理</h2>

                <!-- エクスポート -->
                <div class="data-section">
                    <h3>データエクスポート</h3>
                    <div class="export-options">
                        <div class="export-option">
                            <h4>CSV形式</h4>
                            <p>Excelやスプレッドシートで開けます</p>
                            <button id="exportCsv" class="export-btn">支出データをCSV出力</button>
                            <button id="exportIncomeCsv" class="export-btn">収入データをCSV出力</button>
                            <button id="exportAllCsv" class="export-btn">全データをCSV出力</button>
                        </div>
                        <div class="export-option">
                            <h4>JSON形式</h4>
                            <p>バックアップや他アプリへの移行用</p>
                            <button id="exportJson" class="export-btn">全データをJSON出力</button>
                        </div>
                    </div>
                </div>

                <!-- インポート -->
                <div class="data-section">
                    <h3>データインポート</h3>
                    <div class="import-section">
                        <div class="import-option">
                            <h4>CSVインポート</h4>
                            <p>銀行やカード会社の明細を取り込み</p>
                            <input type="file" id="csvImportFile" accept=".csv" style="display:none;">
                            <label for="csvImportFile" class="import-btn">CSVファイルを選択</label>
                            <div id="csvPreview" class="csv-preview"></div>
                            <div id="csvMapping" class="csv-mapping" style="display:none;">
                                <h5>列のマッピング</h5>
                                <div class="mapping-row">
                                    <label>日付列:</label>
                                    <select id="mapDate"></select>
                                </div>
                                <div class="mapping-row">
                                    <label>説明列:</label>
                                    <select id="mapDescription"></select>
                                </div>
                                <div class="mapping-row">
                                    <label>金額列:</label>
                                    <select id="mapAmount"></select>
                                </div>
                                <div class="mapping-row">
                                    <label>カテゴリ列:</label>
                                    <select id="mapCategory">
                                        <option value="">なし（自動推測）</option>
                                    </select>
                                </div>
                                <button id="importCsvData" class="submit-btn">インポート実行</button>
                            </div>
                        </div>
                        <div class="import-option">
                            <h4>JSONインポート</h4>
                            <p>バックアップからの復元</p>
                            <input type="file" id="jsonImportFile" accept=".json" style="display:none;">
                            <label for="jsonImportFile" class="import-btn">JSONファイルを選択</label>
                        </div>
                    </div>
                </div>

                <!-- バックアップ -->
                <div class="data-section">
                    <h3>自動バックアップ</h3>
                    <div class="backup-settings">
                        <label>
                            <input type="checkbox" id="autoBackup">
                            自動バックアップを有効化
                        </label>
                        <p class="backup-info">データはブラウザのローカルストレージに保存されます。定期的にエクスポートしてバックアップを取ることをお勧めします。</p>
                        <div class="backup-status">
                            <span>最終バックアップ: </span>
                            <span id="lastBackupTime">なし</span>
                        </div>
                    </div>
                </div>

                <!-- データクリア -->
                <div class="data-section danger-zone">
                    <h3>データ削除</h3>
                    <p class="warning-text">この操作は取り消せません。事前にバックアップを取ってください。</p>
                    <button id="clearExpenses" class="danger-btn">支出データを削除</button>
                    <button id="clearAllData" class="danger-btn">全データを削除</button>
                </div>
            </section>

            <!-- 家族・共有タブ -->
            <section id="family" class="tab-content">
                <h2>家族・共有機能</h2>

                <!-- ユーザー管理 -->
                <div class="family-section">
                    <h3>ファミリーメンバー</h3>
                    <div id="familyMembers" class="family-members">
                        <div class="member-card current-user">
                            <span class="member-icon">👤</span>
                            <span class="member-name">自分（オーナー）</span>
                        </div>
                    </div>
                    <button id="addFamilyMember" class="add-member-btn">+ メンバーを追加</button>
                </div>

                <!-- メンバー追加モーダル -->
                <div id="memberModal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h3>メンバーを追加</h3>
                        <form id="memberForm">
                            <div class="form-group">
                                <label for="memberName">名前</label>
                                <input type="text" id="memberName" required>
                            </div>
                            <div class="form-group">
                                <label for="memberIcon">アイコン</label>
                                <select id="memberIcon">
                                    <option value="👨">👨</option>
                                    <option value="👩">👩</option>
                                    <option value="👦">👦</option>
                                    <option value="👧">👧</option>
                                    <option value="👴">👴</option>
                                    <option value="👵">👵</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="memberRole">権限</label>
                                <select id="memberRole">
                                    <option value="editor">編集可能</option>
                                    <option value="viewer">閲覧のみ</option>
                                </select>
                            </div>
                            <button type="submit" class="submit-btn">追加</button>
                        </form>
                    </div>
                </div>

                <!-- 支出の区分 -->
                <div class="family-section">
                    <h3>支出の区分</h3>
                    <div class="expense-type-summary">
                        <div class="expense-type-card">
                            <h4>個人支出</h4>
                            <p id="personalExpenseTotal">¥0</p>
                        </div>
                        <div class="expense-type-card">
                            <h4>家族共有</h4>
                            <p id="sharedExpenseTotal">¥0</p>
                        </div>
                    </div>
                </div>

                <!-- メンバー別支出 -->
                <div class="family-section">
                    <h3>メンバー別支出</h3>
                    <div id="memberExpenses" class="member-expenses"></div>
                </div>

                <!-- 承認待ち -->
                <div class="family-section">
                    <h3>承認待ちの支出</h3>
                    <div class="approval-settings">
                        <label>
                            <input type="checkbox" id="requireApproval">
                            高額支出（<input type="number" id="approvalThreshold" value="10000" style="width:80px;">円以上）は承認を必要とする
                        </label>
                    </div>
                    <div id="pendingApprovals" class="pending-list">
                        <p class="no-pending">承認待ちの支出はありません</p>
                    </div>
                </div>
            </section>

            <!-- ゲーミフィケーションタブ -->
            <section id="gamification" class="tab-content">
                <h2>実績・チャレンジ</h2>

                <!-- ユーザーステータス -->
                <div class="user-status">
                    <div class="level-display">
                        <span class="level-badge" id="userLevel">Lv.1</span>
                        <span class="level-title" id="levelTitle">家計簿ビギナー</span>
                    </div>
                    <div class="exp-bar">
                        <div id="expProgress" class="exp-progress" style="width: 0%"></div>
                    </div>
                    <p class="exp-text">次のレベルまで: <span id="expRemaining">100</span> EXP</p>
                </div>

                <!-- 連続記録 -->
                <div class="streak-section">
                    <h3>連続記録</h3>
                    <div class="streak-cards">
                        <div class="streak-card">
                            <span class="streak-icon">🔥</span>
                            <span id="currentStreak" class="streak-number">0</span>
                            <span class="streak-label">日連続記録中</span>
                        </div>
                        <div class="streak-card">
                            <span class="streak-icon">🏆</span>
                            <span id="maxStreak" class="streak-number">0</span>
                            <span class="streak-label">最長連続記録</span>
                        </div>
                    </div>
                </div>

                <!-- アクティブチャレンジ -->
                <div class="challenges-section">
                    <h3>チャレンジ</h3>
                    <div class="challenge-tabs">
                        <button class="challenge-tab active" data-challenge="active">進行中</button>
                        <button class="challenge-tab" data-challenge="available">参加可能</button>
                        <button class="challenge-tab" data-challenge="completed">完了</button>
                    </div>
                    <div id="challengeList" class="challenge-list"></div>
                </div>

                <!-- バッジ -->
                <div class="badges-section">
                    <h3>獲得バッジ</h3>
                    <div id="badgeList" class="badge-list"></div>
                </div>

                <!-- クイック入力 -->
                <div class="quick-section">
                    <h3>クイック入力</h3>
                    <p>よく使う支出をワンタップで登録</p>
                    <div id="quickInputList" class="quick-input-list"></div>
                    <button id="addQuickInput" class="add-quick-btn">+ クイック入力を追加</button>
                </div>

                <!-- クイック入力追加モーダル -->
                <div id="quickInputModal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h3>クイック入力を追加</h3>
                        <form id="quickInputForm">
                            <div class="form-group">
                                <label for="quickName">名前</label>
                                <input type="text" id="quickName" placeholder="例: コンビニ" required>
                            </div>
                            <div class="form-group">
                                <label for="quickAmount">金額</label>
                                <input type="number" id="quickAmount" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="quickCategory">カテゴリ</label>
                                <select id="quickCategory" required>
                                    <option value="食費">食費</option>
                                    <option value="日用品">日用品</option>
                                    <option value="交通費">交通費</option>
                                    <option value="娯楽費">娯楽費</option>
                                    <option value="その他">その他</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="quickIcon">アイコン</label>
                                <select id="quickIcon">
                                    <option value="🏪">🏪 コンビニ</option>
                                    <option value="☕">☕ カフェ</option>
                                    <option value="🍱">🍱 弁当</option>
                                    <option value="🚃">🚃 電車</option>
                                    <option value="🚕">🚕 タクシー</option>
                                    <option value="🛒">🛒 買い物</option>
                                    <option value="💊">💊 薬</option>
                                    <option value="🎮">🎮 娯楽</option>
                                </select>
                            </div>
                            <button type="submit" class="submit-btn">追加</button>
                        </form>
                    </div>
                </div>

                <!-- 音声入力 -->
                <div class="voice-section">
                    <h3>音声入力</h3>
                    <p>「コンビニで500円」のように話してください</p>
                    <button id="voiceInputBtn" class="voice-btn">
                        <span class="voice-icon">🎤</span>
                        音声で入力
                    </button>
                    <div id="voiceStatus" class="voice-status"></div>
                    <div id="voiceResult" class="voice-result"></div>
                </div>
            </section>

            <!-- 外部連携タブ -->
            <section id="link" class="tab-content">
                <h2>外部サービス連携</h2>

                <!-- 連携モード切替 -->
                <div class="link-mode-tabs">
                    <button class="link-mode-btn active" data-mode="api">API連携</button>
                    <button class="link-mode-btn" data-mode="manual">手動入力</button>
                </div>

                <!-- API連携モード -->
                <div id="apiLinkMode" class="link-mode-content active">
                    <p class="link-description">外部サービスのAPIと連携して、残高・取引データを自動取得します。</p>

                    <!-- API連携サービス一覧 -->
                    <div class="api-services">
                        <!-- 家計簿・資産管理サービス -->
                        <div class="api-category">
                            <h3>家計簿・資産管理サービス</h3>
                            <div class="api-service-grid">
                                <div class="api-service-card" data-service="moneyforward">
                                    <div class="api-service-icon">💰</div>
                                    <div class="api-service-info">
                                        <h4>マネーフォワード ME</h4>
                                        <p>銀行・カード・証券を一括管理</p>
                                    </div>
                                    <div class="api-service-status" id="status-moneyforward">未接続</div>
                                    <button class="api-connect-btn" data-service="moneyforward">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="zaim">
                                    <div class="api-service-icon">📊</div>
                                    <div class="api-service-info">
                                        <h4>Zaim</h4>
                                        <p>日本最大級の家計簿サービス</p>
                                    </div>
                                    <div class="api-service-status" id="status-zaim">未接続</div>
                                    <button class="api-connect-btn" data-service="zaim">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="freee">
                                    <div class="api-service-icon">📈</div>
                                    <div class="api-service-info">
                                        <h4>freee</h4>
                                        <p>クラウド会計ソフト</p>
                                    </div>
                                    <div class="api-service-status" id="status-freee">未接続</div>
                                    <button class="api-connect-btn" data-service="freee">接続設定</button>
                                </div>
                            </div>
                        </div>

                        <!-- 銀行API -->
                        <div class="api-category">
                            <h3>銀行（オープンバンキングAPI）</h3>
                            <div class="api-service-grid">
                                <div class="api-service-card" data-service="mufg">
                                    <div class="api-service-icon">🏦</div>
                                    <div class="api-service-info">
                                        <h4>三菱UFJ銀行</h4>
                                        <p>口座残高・入出金明細</p>
                                    </div>
                                    <div class="api-service-status" id="status-mufg">未接続</div>
                                    <button class="api-connect-btn" data-service="mufg">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="smbc">
                                    <div class="api-service-icon">🏦</div>
                                    <div class="api-service-info">
                                        <h4>三井住友銀行</h4>
                                        <p>口座残高・入出金明細</p>
                                    </div>
                                    <div class="api-service-status" id="status-smbc">未接続</div>
                                    <button class="api-connect-btn" data-service="smbc">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="mizuho">
                                    <div class="api-service-icon">🏦</div>
                                    <div class="api-service-info">
                                        <h4>みずほ銀行</h4>
                                        <p>口座残高・入出金明細</p>
                                    </div>
                                    <div class="api-service-status" id="status-mizuho">未接続</div>
                                    <button class="api-connect-btn" data-service="mizuho">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="rakuten-bank">
                                    <div class="api-service-icon">🏦</div>
                                    <div class="api-service-info">
                                        <h4>楽天銀行</h4>
                                        <p>口座残高・入出金明細</p>
                                    </div>
                                    <div class="api-service-status" id="status-rakuten-bank">未接続</div>
                                    <button class="api-connect-btn" data-service="rakuten-bank">接続設定</button>
                                </div>
                            </div>
                        </div>

                        <!-- 証券会社API -->
                        <div class="api-category">
                            <h3>証券会社</h3>
                            <div class="api-service-grid">
                                <div class="api-service-card" data-service="sbi">
                                    <div class="api-service-icon">📈</div>
                                    <div class="api-service-info">
                                        <h4>SBI証券</h4>
                                        <p>保有資産・取引履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-sbi">未接続</div>
                                    <button class="api-connect-btn" data-service="sbi">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="rakuten-sec">
                                    <div class="api-service-icon">📈</div>
                                    <div class="api-service-info">
                                        <h4>楽天証券</h4>
                                        <p>保有資産・取引履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-rakuten-sec">未接続</div>
                                    <button class="api-connect-btn" data-service="rakuten-sec">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="monex">
                                    <div class="api-service-icon">📈</div>
                                    <div class="api-service-info">
                                        <h4>マネックス証券</h4>
                                        <p>保有資産・取引履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-monex">未接続</div>
                                    <button class="api-connect-btn" data-service="monex">接続設定</button>
                                </div>
                            </div>
                        </div>

                        <!-- クレジットカード -->
                        <div class="api-category">
                            <h3>クレジットカード</h3>
                            <div class="api-service-grid">
                                <div class="api-service-card" data-service="rakuten-card">
                                    <div class="api-service-icon">💳</div>
                                    <div class="api-service-info">
                                        <h4>楽天カード</h4>
                                        <p>利用明細・ポイント</p>
                                    </div>
                                    <div class="api-service-status" id="status-rakuten-card">未接続</div>
                                    <button class="api-connect-btn" data-service="rakuten-card">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="aeon-card">
                                    <div class="api-service-icon">💳</div>
                                    <div class="api-service-info">
                                        <h4>イオンカード</h4>
                                        <p>利用明細・WAONポイント</p>
                                    </div>
                                    <div class="api-service-status" id="status-aeon-card">未接続</div>
                                    <button class="api-connect-btn" data-service="aeon-card">接続設定</button>
                                </div>
                            </div>
                        </div>

                        <!-- 電子マネー・コード決済 -->
                        <div class="api-category">
                            <h3>電子マネー・コード決済</h3>
                            <div class="api-service-grid">
                                <div class="api-service-card" data-service="paypay">
                                    <div class="api-service-icon">📱</div>
                                    <div class="api-service-info">
                                        <h4>PayPay</h4>
                                        <p>残高・決済履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-paypay">未接続</div>
                                    <button class="api-connect-btn" data-service="paypay">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="linepay">
                                    <div class="api-service-icon">📱</div>
                                    <div class="api-service-info">
                                        <h4>LINE Pay</h4>
                                        <p>残高・決済履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-linepay">未接続</div>
                                    <button class="api-connect-btn" data-service="linepay">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="merpay">
                                    <div class="api-service-icon">📱</div>
                                    <div class="api-service-info">
                                        <h4>メルペイ</h4>
                                        <p>残高・決済履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-merpay">未接続</div>
                                    <button class="api-connect-btn" data-service="merpay">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="suica">
                                    <div class="api-service-icon">🚃</div>
                                    <div class="api-service-info">
                                        <h4>モバイルSuica</h4>
                                        <p>残高・利用履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-suica">未接続</div>
                                    <button class="api-connect-btn" data-service="suica">接続設定</button>
                                </div>
                            </div>
                        </div>

                        <!-- ポイント -->
                        <div class="api-category">
                            <h3>ポイントサービス</h3>
                            <div class="api-service-grid">
                                <div class="api-service-card" data-service="rakuten-point">
                                    <div class="api-service-icon">🎁</div>
                                    <div class="api-service-info">
                                        <h4>楽天ポイント</h4>
                                        <p>ポイント残高・履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-rakuten-point">未接続</div>
                                    <button class="api-connect-btn" data-service="rakuten-point">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="tpoint">
                                    <div class="api-service-icon">🎁</div>
                                    <div class="api-service-info">
                                        <h4>Tポイント</h4>
                                        <p>ポイント残高・履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-tpoint">未接続</div>
                                    <button class="api-connect-btn" data-service="tpoint">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="dpoint">
                                    <div class="api-service-icon">🎁</div>
                                    <div class="api-service-info">
                                        <h4>dポイント</h4>
                                        <p>ポイント残高・履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-dpoint">未接続</div>
                                    <button class="api-connect-btn" data-service="dpoint">接続設定</button>
                                </div>
                            </div>
                        </div>

                        <!-- ECサイト -->
                        <div class="api-category">
                            <h3>ECサイト</h3>
                            <div class="api-service-grid">
                                <div class="api-service-card" data-service="amazon">
                                    <div class="api-service-icon">🛒</div>
                                    <div class="api-service-info">
                                        <h4>Amazon</h4>
                                        <p>注文履歴・ギフト券残高</p>
                                    </div>
                                    <div class="api-service-status" id="status-amazon">未接続</div>
                                    <button class="api-connect-btn" data-service="amazon">接続設定</button>
                                </div>

                                <div class="api-service-card" data-service="rakuten-ichiba">
                                    <div class="api-service-icon">🛒</div>
                                    <div class="api-service-info">
                                        <h4>楽天市場</h4>
                                        <p>注文履歴</p>
                                    </div>
                                    <div class="api-service-status" id="status-rakuten-ichiba">未接続</div>
                                    <button class="api-connect-btn" data-service="rakuten-ichiba">接続設定</button>
                                </div>
                            </div>
                        </div>

                        <!-- カスタムAPI -->
                        <div class="api-category">
                            <h3>カスタムAPI接続</h3>
                            <div class="custom-api-section">
                                <p>独自のAPIエンドポイントを設定して接続できます。</p>
                                <button id="addCustomApiBtn" class="add-custom-api-btn">+ カスタムAPIを追加</button>
                                <div id="customApiList" class="custom-api-list"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 同期コントロール -->
                    <div class="sync-controls">
                        <button id="syncAllBtn" class="sync-btn">
                            <span class="sync-icon">🔄</span>
                            すべて同期
                        </button>
                        <div class="last-sync">
                            最終同期: <span id="lastSyncTime">未同期</span>
                        </div>
                    </div>

                    <!-- 同期ログ -->
                    <div class="sync-log">
                        <h3>同期ログ</h3>
                        <div id="syncLogContent" class="sync-log-content">
                            <p class="no-log">同期履歴はありません</p>
                        </div>
                    </div>
                </div>

                <!-- 手動入力モード -->
                <div id="manualLinkMode" class="link-mode-content">
                    <p class="link-description">各サービスから取得した明細を手動で入力・更新できます。</p>

                    <div class="link-services">
                        <!-- 銀行口座 -->
                        <div class="service-card">
                            <div class="service-header">
                                <span class="service-icon">🏦</span>
                                <h3>銀行口座</h3>
                            </div>
                            <div class="service-accounts" id="bankAccounts">
                                <div class="account-item">
                                    <input type="text" placeholder="口座名（例：〇〇銀行）" class="account-name">
                                    <input type="number" placeholder="残高" class="account-balance">
                                    <button class="remove-account">×</button>
                                </div>
                            </div>
                            <button class="add-account-btn" data-type="bank">+ 口座を追加</button>
                        </div>

                        <!-- 証券口座 -->
                        <div class="service-card">
                            <div class="service-header">
                                <span class="service-icon">📈</span>
                                <h3>証券口座</h3>
                            </div>
                            <div class="service-accounts" id="securitiesAccounts">
                                <div class="account-item">
                                    <input type="text" placeholder="口座名（例：〇〇証券）" class="account-name">
                                    <input type="number" placeholder="評価額" class="account-balance">
                                    <button class="remove-account">×</button>
                                </div>
                            </div>
                            <button class="add-account-btn" data-type="securities">+ 口座を追加</button>
                        </div>

                        <!-- クレジットカード -->
                        <div class="service-card">
                            <div class="service-header">
                                <span class="service-icon">💳</span>
                                <h3>クレジットカード</h3>
                            </div>
                            <div class="service-accounts" id="creditCards">
                                <div class="account-item">
                                    <input type="text" placeholder="カード名" class="account-name">
                                    <input type="number" placeholder="利用額" class="account-balance">
                                    <button class="remove-account">×</button>
                                </div>
                            </div>
                            <button class="add-account-btn" data-type="credit">+ カードを追加</button>
                        </div>

                        <!-- 電子マネー -->
                        <div class="service-card">
                            <div class="service-header">
                                <span class="service-icon">💰</span>
                                <h3>電子マネー</h3>
                            </div>
                            <div class="service-accounts" id="eMoney">
                                <div class="account-item">
                                    <input type="text" placeholder="名称（例：Suica）" class="account-name">
                                    <input type="number" placeholder="残高" class="account-balance">
                                    <button class="remove-account">×</button>
                                </div>
                            </div>
                            <button class="add-account-btn" data-type="emoney">+ 電子マネーを追加</button>
                        </div>

                        <!-- コード決済 -->
                        <div class="service-card">
                            <div class="service-header">
                                <span class="service-icon">📱</span>
                                <h3>コード決済</h3>
                            </div>
                            <div class="service-accounts" id="qrPayments">
                                <div class="account-item">
                                    <input type="text" placeholder="名称（例：PayPay）" class="account-name">
                                    <input type="number" placeholder="残高" class="account-balance">
                                    <button class="remove-account">×</button>
                                </div>
                            </div>
                            <button class="add-account-btn" data-type="qr">+ サービスを追加</button>
                        </div>

                        <!-- ポイント -->
                        <div class="service-card">
                            <div class="service-header">
                                <span class="service-icon">🎁</span>
                                <h3>ポイント</h3>
                            </div>
                            <div class="service-accounts" id="points">
                                <div class="account-item">
                                    <input type="text" placeholder="名称（例：楽天ポイント）" class="account-name">
                                    <input type="number" placeholder="ポイント数" class="account-balance">
                                    <button class="remove-account">×</button>
                                </div>
                            </div>
                            <button class="add-account-btn" data-type="points">+ ポイントを追加</button>
                        </div>

                        <!-- ECサイト -->
                        <div class="service-card">
                            <div class="service-header">
                                <span class="service-icon">🛒</span>
                                <h3>ECサイト残高</h3>
                            </div>
                            <div class="service-accounts" id="ecSites">
                                <div class="account-item">
                                    <input type="text" placeholder="名称（例：Amazonギフト券）" class="account-name">
                                    <input type="number" placeholder="残高" class="account-balance">
                                    <button class="remove-account">×</button>
                                </div>
                            </div>
                            <button class="add-account-btn" data-type="ec">+ サイトを追加</button>
                        </div>
                    </div>

                    <button id="saveLinkedAccounts" class="submit-btn">連携情報を保存</button>
                </div>

                <!-- 資産サマリー -->
                <div class="asset-summary">
                    <h3>資産サマリー</h3>
                    <div id="assetSummaryContent" class="asset-summary-grid"></div>
                    <div class="total-assets">
                        <span>総資産:</span>
                        <span id="totalAssets" class="total-value">¥0</span>
                    </div>
                </div>
            </section>
        </main>

        <!-- 編集モーダル -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>支出を編集</h3>
                <form id="editForm">
                    <input type="hidden" id="editId">
                    <div class="form-group">
                        <label for="editDate">日付</label>
                        <input type="date" id="editDate" required>
                    </div>
                    <div class="form-group">
                        <label for="editDescription">説明</label>
                        <input type="text" id="editDescription" required>
                    </div>
                    <div class="form-group">
                        <label for="editAmount">金額</label>
                        <input type="number" id="editAmount" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="editCategory">カテゴリ</label>
                        <select id="editCategory" required>
                            <option value="食費">食費</option>
                            <option value="日用品">日用品</option>
                            <option value="交通費">交通費</option>
                            <option value="光熱費">光熱費</option>
                            <option value="通信費">通信費</option>
                            <option value="住居費">住居費</option>
                            <option value="医療費">医療費</option>
                            <option value="娯楽費">娯楽費</option>
                            <option value="衣服費">衣服費</option>
                            <option value="教育費">教育費</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>
                    <button type="submit" class="submit-btn">更新</button>
                </form>
            </div>
        </div>

        <!-- API接続設定モーダル -->
        <div id="apiConfigModal" class="modal">
            <div class="modal-content modal-large">
                <span class="close-modal">&times;</span>
                <h3 id="apiConfigTitle">API接続設定</h3>
                <div id="apiConfigContent">
                    <input type="hidden" id="apiConfigService">

                    <!-- 認証方式選択 -->
                    <div class="form-group">
                        <label>認証方式</label>
                        <select id="apiAuthType">
                            <option value="account">アカウント（ID・パスワード）</option>
                            <option value="oauth2">OAuth 2.0</option>
                            <option value="apikey">APIキー</option>
                            <option value="basic">Basic認証</option>
                            <option value="bearer">Bearerトークン</option>
                        </select>
                    </div>

                    <!-- アカウント認証設定 -->
                    <div id="accountSettings" class="auth-settings">
                        <div class="account-login-info">
                            <p class="auth-info-text">サービスのログイン情報を入力してください。</p>
                            <p class="auth-warning-text">※ログイン情報はローカルに暗号化して保存されます。第三者に共有されることはありません。</p>
                        </div>
                        <div class="form-group">
                            <label>ログインURL</label>
                            <input type="url" id="accountLoginUrl" placeholder="https://www.example.com/login">
                        </div>
                        <div class="form-group">
                            <label>ログインID（メールアドレス等）</label>
                            <input type="text" id="accountLoginId" placeholder="example@email.com" autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label>パスワード</label>
                            <div class="password-input-wrapper">
                                <input type="password" id="accountPassword" placeholder="パスワード" autocomplete="off">
                                <button type="button" class="toggle-password-btn" onclick="togglePasswordVisibility('accountPassword')">👁</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="accountRemember" checked>
                                ログイン情報を保存する
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="accountAutoSync">
                                自動同期を有効にする（1日1回）
                            </label>
                        </div>
                    </div>

                    <!-- OAuth 2.0設定 -->
                    <div id="oauth2Settings" class="auth-settings">
                        <div class="form-group">
                            <label>クライアントID</label>
                            <input type="text" id="oauthClientId" placeholder="クライアントID">
                        </div>
                        <div class="form-group">
                            <label>クライアントシークレット</label>
                            <input type="password" id="oauthClientSecret" placeholder="クライアントシークレット">
                        </div>
                        <div class="form-group">
                            <label>認可エンドポイント</label>
                            <input type="url" id="oauthAuthUrl" placeholder="https://api.example.com/oauth/authorize">
                        </div>
                        <div class="form-group">
                            <label>トークンエンドポイント</label>
                            <input type="url" id="oauthTokenUrl" placeholder="https://api.example.com/oauth/token">
                        </div>
                        <div class="form-group">
                            <label>スコープ（カンマ区切り）</label>
                            <input type="text" id="oauthScopes" placeholder="read,write,accounts">
                        </div>
                        <div class="form-group">
                            <label>リダイレクトURI</label>
                            <input type="url" id="oauthRedirectUri" placeholder="https://yourapp.com/callback" readonly>
                        </div>
                    </div>

                    <!-- APIキー設定 -->
                    <div id="apikeySettings" class="auth-settings" style="display: none;">
                        <div class="form-group">
                            <label>APIキー</label>
                            <input type="password" id="apiKey" placeholder="APIキーを入力">
                        </div>
                        <div class="form-group">
                            <label>APIキーヘッダー名</label>
                            <input type="text" id="apiKeyHeader" placeholder="X-API-Key" value="X-API-Key">
                        </div>
                    </div>

                    <!-- Basic認証設定 -->
                    <div id="basicSettings" class="auth-settings" style="display: none;">
                        <div class="form-group">
                            <label>ユーザー名</label>
                            <input type="text" id="basicUsername" placeholder="ユーザー名">
                        </div>
                        <div class="form-group">
                            <label>パスワード</label>
                            <input type="password" id="basicPassword" placeholder="パスワード">
                        </div>
                    </div>

                    <!-- Bearerトークン設定 -->
                    <div id="bearerSettings" class="auth-settings" style="display: none;">
                        <div class="form-group">
                            <label>アクセストークン</label>
                            <input type="password" id="bearerToken" placeholder="アクセストークン">
                        </div>
                    </div>

                    <!-- APIエンドポイント設定 -->
                    <div class="api-endpoints-section">
                        <h4>APIエンドポイント</h4>
                        <div class="form-group">
                            <label>ベースURL</label>
                            <input type="url" id="apiBaseUrl" placeholder="https://api.example.com/v1">
                        </div>
                        <div class="form-group">
                            <label>残高取得エンドポイント</label>
                            <input type="text" id="apiBalanceEndpoint" placeholder="/accounts/balance">
                        </div>
                        <div class="form-group">
                            <label>取引履歴エンドポイント</label>
                            <input type="text" id="apiTransactionsEndpoint" placeholder="/accounts/transactions">
                        </div>
                    </div>

                    <!-- データマッピング設定 -->
                    <div class="data-mapping-section">
                        <h4>データマッピング</h4>
                        <p class="mapping-description">APIレスポンスのフィールド名を指定してください（JSONPath形式）</p>
                        <div class="form-group">
                            <label>残高フィールド</label>
                            <input type="text" id="mappingBalance" placeholder="data.balance" value="data.balance">
                        </div>
                        <div class="form-group">
                            <label>取引日付フィールド</label>
                            <input type="text" id="mappingDate" placeholder="data.transactions[].date" value="data.transactions[].date">
                        </div>
                        <div class="form-group">
                            <label>取引金額フィールド</label>
                            <input type="text" id="mappingAmount" placeholder="data.transactions[].amount" value="data.transactions[].amount">
                        </div>
                        <div class="form-group">
                            <label>取引説明フィールド</label>
                            <input type="text" id="mappingDescription" placeholder="data.transactions[].description" value="data.transactions[].description">
                        </div>
                    </div>

                    <div class="api-config-actions">
                        <button id="testApiConnection" class="test-btn">接続テスト</button>
                        <button id="startOAuthFlow" class="oauth-btn" style="display: none;">OAuth認証を開始</button>
                        <button id="startAccountLogin" class="account-login-btn">アカウントでログイン</button>
                        <button id="saveApiConfig" class="submit-btn">設定を保存</button>
                    </div>

                    <div id="apiTestResult" class="api-test-result"></div>
                </div>
            </div>
        </div>

        <!-- カスタムAPI追加モーダル -->
        <div id="customApiModal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>カスタムAPIを追加</h3>
                <form id="customApiForm">
                    <div class="form-group">
                        <label>サービス名</label>
                        <input type="text" id="customApiName" placeholder="例：自社システム" required>
                    </div>
                    <div class="form-group">
                        <label>カテゴリ</label>
                        <select id="customApiCategory" required>
                            <option value="bank">銀行口座</option>
                            <option value="securities">証券口座</option>
                            <option value="credit">クレジットカード</option>
                            <option value="emoney">電子マネー</option>
                            <option value="qr">コード決済</option>
                            <option value="points">ポイント</option>
                            <option value="ec">ECサイト</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>説明</label>
                        <input type="text" id="customApiDescription" placeholder="サービスの説明">
                    </div>
                    <button type="submit" class="submit-btn">追加</button>
                </form>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
